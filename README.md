# spider-collect-data-analyse-doc
爬虫分析数据平台-文档

### 爬虫指标菜单栏：
1. 仪表盘：
	- BiliBili-爬取总视频数量、总用户数量、总评论数量、总弹幕数量
	- 已分析用户与视频数量
	- 正在运行的爬取实例
	- 过往日周月周期数据占比
	- 日周月周期数据量
	- 总成功率失败率，失败记录条数
	- CPU占用率、数据库磁盘空间占用率
2. 样本与实例：
	- 多种爬虫样本
	- 多种状态爬虫实例（样本生成运行实例）
3. 实例数据：
	- BiliBili - 各分区热门视频、综合热门视频、每周必看、入站必刷、用户分析、视频分析
	- 数据展示
	- 数据导出
4. 运行日志：
	- 请求参数
	- 响应参数
	- 成功率
	- 失败率
	- 耗时
	- 抓取速率
	- 抓取延迟
	- 请求次数
5. 运行状态监控：
	- 启动时间
	- 执行时间
	- 结束时间
	- 停止/暂停
	- 启动
	- 终止
6. IP/UA代理池
7. 节点监控：
	- 当前计算机运行状态
	- 数据库资源占用
	- 资源占用
8. 通知日志：
	- 微信/QQ/短信通知
9. 全局ID发布

### 爬虫抓取业务逻辑
B站抓取路线分两类：
1. 分析视频：视频出发，抓取视频信息+评论+弹幕+发布者信息
2. 分析用户：用户出发，抓取用户空间与粉丝群体，包括用户空间的发布视频信息，与粉丝群体画像
抓取周期：
1. 热门视频，周期性抓取，分析视频+分析用户
2. 用户设置，周期性抓取
3. 用户设置，单次抓取
抓取范围
1. 分析视频：视频基础信息，评论，评论词图，评论用户群体画像，弹幕，弹幕词图，弹幕用户群体画像，用户个人简略信息（即分析视频=视频+评论+弹幕+用户）
2. 分析用户：用户个人信息，用户空间视频合集，视频合集简略视频信息，用户粉丝群体简略信息，粉丝群体画像（即分析用户=用户+投稿合集+粉丝）

实体类-样本-实例-批次-步骤-记录
- 开始由即实体类出发
- 选择实体类录入生成样本，存在同名样本且样本为有效则不允许重复录入
- 样本运行即生成运行实例，需要存在该实体类的样本且状态为有效状态，运行实例才允许运行；运行实例存在四种类型（定时任务、线程池、HTTP调用、MQ消费），且运行实例存在四种状态（初始化、运行、销毁、失败）；样本运行生成的每个实例，都需要将实例记录存入数据库，并选择类型且更新状态
- 每个运行实例下存在关联的抓取批次与抓取步骤，步骤下的多条记录

视频：
序号
BV
AID
分区
封面
标题
描述
发布时间
投稿时间
稿件总时长
参与的活动
播放数
弹幕数
评论数
收藏数
投币数
分享数
当前排名
历史最高排行
获赞数
点踩数
视频评分

分P
分P列表（分P标题，分P来源，分P序号，分P时长）

UP主：
mid
昵称
性别
签名
用户权限
当前等级
封禁状态
就读大学名称
是否开启充电

资质=资质名称、职位、所属机构

粉丝勋章信息=所属粉丝mid，勋章id，勋章等级，勋章名称，亲密度，下一等级亲密度，每日亲密度获取上限，今日获得亲密度，是否佩戴

认证信息=认证信息，认证备注，是否认证（无、个人、机构）

vip会员信息=会员类型，会员状态，会员过期时间，支付类型，大角色类型，电视大会员状态，电视大会员支付类型

勋章=名称，图表，等级，获取条件

直播间=直播间状态、直播状态，url，标题，直播间id，轮播状态

用户状态=关注、悄悄关注、黑名单、粉丝

用户tag

上热榜记录

视频标签

评论：
热评
置顶信息
置顶评论
抽奖评论
评论区公告

评论rpid
评论区视频aid
评论发送用户
根评论rpid
回复父评论rpid
评论状态，正常或被屏蔽
是否具有粉丝标签
发送时间
评论获赞数
评论信息
评论是否被隐藏
评论是否up觉得很赞
评论是否被up回复
被回复数量


关联视频


弹幕：
弹幕dmid 
视频内弹幕出现时间
类型
字号
颜色
发送者midHash
内容
发送时间
权重
弹幕池
属性位